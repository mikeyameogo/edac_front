
<p-card>
  <div class="_m-t-15">
<div class="alert alert-success" *ngIf="paiementComplete">L'opération de paiement a reussi!!</div>
      <!-- <div class="btn btn-secondary" (click)="goToPaiement()">Ligdicash</div> -->
    <div class="p-d-flex">
      <div class="p-ml-auto">
        <p-message *ngIf="message" [severity]="message.severity" [text]="message.summary"></p-message>
        <p-progressSpinner *ngIf="isOpInProgress" strokeWidth="4" [style]="{width: '50px', height: '50px'}">
        </p-progressSpinner>
      </div>
    </div>
  </div>
  <form name="editFormF" role="form" novalidate #editFormF="ngForm" class="filter-design" style="margin-top: 20px;">
      <div class="row justify-content-center">
          <div class="form-group col-md-8 m-b-3">
            <span class="p-input-icon-left w-full">
              <i class="pi pi-search"></i>
              <input type="text" pInputText [(ngModel)]="filtreNumero" class="form-control filter-item-design" name="filterText"
                  id="filterText" placeholder="Filtrer par numero" required/>
            </span>
          </div>

          <div class="form-group col-md-2 m-b-3">
            <button pButton label="Filtrer" icon="pi pi-search" class="btn float-right mb-2 p-button-filter filter-item-design"
              [disabled]="!enableCreate" style="width: 100%" [disabled]="editFormF.form.invalid" (click)="filtrer()" ngbTooltip="Appliquer le filtre">
             </button>
          </div>
          <div class="form-group col-md-2 m-b-3">
              <button pButton type="button" icon="pi pi-trash"  class="btn p-button-info p-button-filter filter-item-design" style="width: 100%" [disabled]="!filtreNumero" (click)="resetFilter()"
                  ngbTooltip="Annuler le filtre">
                   Rénitialiser
              </button>
          </div>
      </div>
  </form>
<div class="row mt-4">
    <div class="col-md-8">
      <p class="float-left">Résultats trouvés : <span class="text-danger">{{totalRecords}}</span></p>
    </div>
    <div class="col-md-4">
      <app-crud-toolbar [enableCreate]="enableCreate" (create)="openModalCreate()" [enableEdit]="enableBtnEdit"
        (edit)="openModalEdit(demande)">
      </app-crud-toolbar>
    </div>
</div>
  <p-table #dtf [value]="demandes" [paginator]="true" [rows]="recordsPerPage"  (onPage)="loadPage($event)"
    [totalRecords]="totalRecords"  (onLazyLoad)="loadMesDemandes()" [lazy]="true"
    [globalFilterFields]="['numero','dateDemande','structDestination']"
    currentPageReportTemplate="Affichage {first} à {last} de {totalRecords} élements"
    [showCurrentPageReport]=true
    [rowsPerPageOptions]="[20, 50, 100, 500]" styleClass="p-datatable-gridlines">

    <ng-template pTemplate="header" let-columns>
      <tr>
        <th pSortableColumn="numero">Numero<p-sortIcon field="numero"></p-sortIcon></th>
        <th pSortableColumn="dateDemande">Date<p-sortIcon field="dateDemande"></p-sortIcon></th>
        <th pSortableColumn="strucDestination">Structure de détachement<p-sortIcon field="strucDestination"></p-sortIcon></th>
        <th pSortableColumn="dateEffet">Date d'effet<p-sortIcon field="dateEffet"></p-sortIcon></th>
        <th pSortableColumn="statut">Statut<p-sortIcon field="statut"></p-sortIcon></th>
        <th class="actionsStyle">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-demande>
      <tr>
        <td>{{ demande.numero }}</td>
        <td>{{ demande.dateDemande }}</td>
        <td>{{ demande.destination.libelle }}</td>
        <td>{{ demande.dateEffet }}</td>

        <td>
          <span class="statut-label" [ngClass]="{
            'statut-initiee': demande.statut === 'INITIEE',
            'statut-payee': demande.statut === 'PAYEE',
            'statut-avis-sh': demande.statut === 'AVIS_SH',
            'statut-avis-drh': demande.statut === 'AVIS_DRH',
            'statut-avis-dgfp': demande.statut === 'AVIS_DGFP',
            'statut-receptionee': demande.statut === 'RECEPTIONEE',
            'statut-imputee': demande.statut === 'IMPUTEE',
            'statut-conforme': demande.statut === 'CONFORME',
            'statut-rejet-ca': demande.statut === 'REJET_CA',
            'statut-rejet-drh': demande.statut === 'REJET_DRH',
            'statut-validee': demande.statut === 'VALIDEE',
            'statut-refusee': demande.statut === 'REFUSEE',
            'statut-rejet-sg': demande.statut === 'REJET_SG',
            'statut-abandonnee': demande.statut === 'ABANDONNEE',
            'statut-elaboration': demande.statut === 'ELABORATION',
            'statut-clos': demande.statut === 'CLOS',
            'statut-demande-validee': demande.statut === 'DEMANDE_VALIDEE',
            'statut-demande-rejetee': demande.statut === 'DEMANDE_REJETEE',
            'statut-projet-elabore': demande.statut === 'PROJET_ELABORE',
            'statut-projet-valide': demande.statut === 'PROJET_VALIDE',
            'statut-projet-verifie': demande.statut === 'PROJET_VERIFIE',
            'statut-projet-vise': demande.statut === 'PROJET_VISE',
            'statut-projet-signe': demande.statut === 'PROJET_SIGNE',
            'statut-projet-rejete': demande.statut === 'PROJET_REJETE'
          }">{{ demande.statut }}</span>
        </td>


        <td class="actionsStyle">
          <app-actions-toolbar-iud [enableBtnInfo]="enableBtnInfo" (info)="openModalDetail(demande)"  [enableBtnPaiement]="enableBtnPaiement && (demande.statut !== 'PAYEE' && demande.statut !== 'AVIS_SH' && demande.statut !== 'AVIS_DRH'  && demande.statut !== 'RECEPTIONEE'&& demande.statut !== 'IMPUTEE'  && demande.statut !== 'VALIDEE' && demande.statut !== 'CONFORME' && demande.statut !== 'ELABORATION' && demande.statut !== 'CLOS' && demande.statut !== 'DEMANDE_VALIDEE' && demande.statut !== 'REJET_CA' && demande.statut !== 'REJET_DRH' && demande.statut !== 'REJET_SG' && demande.statut !== 'PROJET_SIGNE' && demande.statut !== 'PROJET_REJETE' )" 
          (paiement)="goToPaiement(demande)"
          [enableBtnInfo]="enableBtnInfo" (generate)="generateRecipisse(demande)" [enableBtnRecipisse]="enableBtnRecipisse&& (demande.statut !== 'CLOS')"
          (download)="downloadActe(demande)" [enableBtnDownload]="enableBtnDownload && (demande.statut === 'CLOS')"
          (edit)="isEditButtonVisible(demande) ? openModalEdit(demande) : null" [enableBtnEdit]="enableBtnEdit && (demande.statut === 'REJET_CA')"
          (delete)="onDelete(demande)" [enableBtnDelete]="enableBtnDelete"  (abandonner)="onAbandonner(demande)" [enableBtnAbandonner]="enableBtnAbandonner && (demande.statut !== 'ELABORATION' && demande.statut !== 'CLOS' && demande.statut !== 'ABANDONNEE')"
          >
        </app-actions-toolbar-iud>
        </td>
      </tr>




    </ng-template>
  </p-table>


  <!-- Confirmation -->
  <app-confirmation></app-confirmation>
</p-card>
